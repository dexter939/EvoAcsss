# ===================================
# ACS (Auto Configuration Server)
# Environment Configuration Template
# ===================================

# ----------------------------------
# Application Settings
# ----------------------------------
APP_NAME="ACS System"
APP_ENV=local
APP_KEY=
APP_DEBUG=true
APP_URL=http://localhost

# Localization
APP_LOCALE=en
APP_FALLBACK_LOCALE=en
APP_FAKER_LOCALE=en_US

# Maintenance
APP_MAINTENANCE_DRIVER=file
# APP_MAINTENANCE_STORE=database

# PHP Server
PHP_CLI_SERVER_WORKERS=4

# Security
BCRYPT_ROUNDS=12

# ----------------------------------
# Logging Configuration
# ----------------------------------
LOG_CHANNEL=stack
LOG_STACK=single
LOG_DEPRECATIONS_CHANNEL=null
LOG_LEVEL=debug

# ----------------------------------
# Database Configuration (PostgreSQL)
# Production: Use PostgreSQL for 100K+ devices
# Development: SQLite OK for testing
# ----------------------------------

# PostgreSQL (Recommended for Production)
DB_CONNECTION=pgsql
DB_HOST=127.0.0.1
DB_PORT=5432
DB_DATABASE=acs_database
DB_USERNAME=acs_user
DB_PASSWORD=change_me_in_production
DB_SSLMODE=prefer
DB_TIMEOUT=5

# SQLite (Development Only)
# DB_CONNECTION=sqlite
# DB_DATABASE=/absolute/path/to/database.sqlite

# ----------------------------------
# Database Read Replicas (Production HA)
# ----------------------------------
# Enable for high-availability with read/write splitting
DB_READ_REPLICA_ENABLED=false

# Read replica hosts (up to 3)
# DB_READ_HOST_1=replica-1.db.example.com
# DB_READ_HOST_2=replica-2.db.example.com
# DB_READ_HOST_3=replica-3.db.example.com
# DB_READ_PORT=5432

# Sticky sessions: route subsequent reads to same connection after write
DB_STICKY=true

# ----------------------------------
# Session & Cache Configuration
# ----------------------------------
# Options: database, tenant_database (for multi-tenant isolation), redis, file
# Use tenant_database when TENANT_ENABLED=true for session isolation
SESSION_DRIVER=database
SESSION_LIFETIME=120
SESSION_ENCRYPT=false
SESSION_PATH=/
SESSION_DOMAIN=null

BROADCAST_CONNECTION=log
FILESYSTEM_DISK=local

# Cache (Database or Redis recommended)
CACHE_STORE=database
# CACHE_PREFIX=acs_

# ----------------------------------
# Queue System (Laravel Horizon)
# ----------------------------------
# Use Redis for production queue processing
QUEUE_CONNECTION=redis
# QUEUE_CONNECTION=database  # Alternative for development

# ----------------------------------
# Redis Configuration
# Required for: Queue (Horizon), WebSocket routing, Cache
# ----------------------------------
REDIS_CLIENT=phpredis
REDIS_HOST=127.0.0.1
REDIS_PASSWORD=null
REDIS_PORT=6379
REDIS_DB=0
REDIS_CACHE_DB=1
REDIS_SESSION_DB=2
REDIS_METRICS_DB=3
REDIS_QUEUE_DB=4
REDIS_BROADCAST_DB=5

# Redis Timeouts & Resilience
REDIS_TIMEOUT=5
REDIS_READ_TIMEOUT=60
REDIS_MAX_RETRIES=3
REDIS_PERSISTENT=false

# Redis TLS (for cloud-managed Redis)
REDIS_TLS=false
REDIS_TLS_VERIFY=true

# ----------------------------------
# Redis Cluster (Production HA)
# ----------------------------------
# Enable for production with 6-node cluster (3 masters + 3 replicas)
REDIS_CLUSTER_ENABLED=false
# REDIS_CLUSTER_NODE_1=redis-node-1.example.com
# REDIS_CLUSTER_PORT_1=6379
# REDIS_CLUSTER_NODE_2=redis-node-2.example.com
# REDIS_CLUSTER_PORT_2=6379
# REDIS_CLUSTER_NODE_3=redis-node-3.example.com
# REDIS_CLUSTER_PORT_3=6379
# REDIS_CLUSTER_NODE_4=redis-node-4.example.com
# REDIS_CLUSTER_PORT_4=6379
# REDIS_CLUSTER_NODE_5=redis-node-5.example.com
# REDIS_CLUSTER_PORT_5=6379
# REDIS_CLUSTER_NODE_6=redis-node-6.example.com
# REDIS_CLUSTER_PORT_6=6379

# ----------------------------------
# Redis Sentinel (Alternative HA)
# ----------------------------------
# Enable for Sentinel-based failover
REDIS_SENTINEL_ENABLED=false
# REDIS_SENTINEL_1=sentinel-1:26379
# REDIS_SENTINEL_2=sentinel-2:26379
# REDIS_SENTINEL_3=sentinel-3:26379
# REDIS_SENTINEL_SERVICE=mymaster

# ----------------------------------
# Mail Configuration
# ----------------------------------
MAIL_MAILER=log
MAIL_SCHEME=null
MAIL_HOST=127.0.0.1
MAIL_PORT=2525
MAIL_USERNAME=null
MAIL_PASSWORD=null
MAIL_FROM_ADDRESS="noreply@acs.local"
MAIL_FROM_NAME="${APP_NAME}"

# ----------------------------------
# AWS S3 (Optional - Firmware Storage)
# ----------------------------------
AWS_ACCESS_KEY_ID=
AWS_SECRET_ACCESS_KEY=
AWS_DEFAULT_REGION=us-east-1
AWS_BUCKET=
AWS_USE_PATH_STYLE_ENDPOINT=false

# ----------------------------------
# ACS API Configuration
# ----------------------------------
# API Key for RESTful endpoints (/api/v1/*)
# ⚠️ CHANGE IN PRODUCTION - Used for device/admin API access
ACS_API_KEY=acs-secret-key-change-in-production

# ----------------------------------
# TR-069 (CWMP) Configuration
# ----------------------------------
# TR-069 endpoint: /tr069
TR069_ENABLED=true
TR069_SESSION_TIMEOUT=300
TR069_MAX_ENVELOPE_SIZE=32768

# Connection Request Authentication
TR069_CONNECTION_USERNAME=admin
TR069_CONNECTION_PASSWORD=admin123

# ----------------------------------
# TR-369 (USP) Protocol Configuration
# ----------------------------------
# USP Controller Endpoint ID (BBF TR-369 spec)
USP_CONTROLLER_ENDPOINT_ID=proto::acs-controller

# Default device registration values
USP_DEFAULT_OUI=000000
USP_DEFAULT_PRODUCT_CLASS="USP Device"

# ----------------------------------
# MQTT Transport Layer (MTP)
# ----------------------------------
# MQTT Broker for USP device communication
# Development: Use test.mosquitto.org or local broker
# Production: Use dedicated broker (Mosquitto, VerneMQ, EMQX)

MQTT_HOST=test.mosquitto.org
MQTT_PORT=1883
MQTT_CLIENT_ID=acs-controller
MQTT_USERNAME=
MQTT_PASSWORD=

# MQTT Connection Settings
MQTT_CLEAN_SESSION=true
MQTT_ENABLE_LOGGING=true
MQTT_CONNECT_TIMEOUT=60
MQTT_SOCKET_TIMEOUT=5
MQTT_KEEP_ALIVE_INTERVAL=10
MQTT_RESEND_TIMEOUT=10

# MQTT Auto-Reconnect (Production)
MQTT_AUTO_RECONNECT_ENABLED=true
MQTT_AUTO_RECONNECT_MAX_RECONNECT_ATTEMPTS=10
MQTT_AUTO_RECONNECT_DELAY_BETWEEN_RECONNECT_ATTEMPTS=5

# MQTT TLS/SSL (Production - use port 8883)
MQTT_TLS_ENABLED=false
MQTT_TLS_ALLOW_SELF_SIGNED_CERT=false
MQTT_TLS_VERIFY_PEER=true
MQTT_TLS_VERIFY_PEER_NAME=true
MQTT_TLS_CA_FILE=
MQTT_TLS_CLIENT_CERT_FILE=
MQTT_TLS_CLIENT_CERT_KEY_FILE=
MQTT_TLS_CLIENT_CERT_KEY_PASSPHRASE=

# MQTT Last Will (Controller status notification)
MQTT_LAST_WILL_TOPIC=usp/controller/status
MQTT_LAST_WILL_MESSAGE={"status":"offline"}
MQTT_LAST_WILL_QUALITY_OF_SERVICE=1
MQTT_LAST_WILL_RETAIN=true

# MQTT Topics (USP Standard - BBF TR-369)
# Controller subscribes to: usp/controller/{endpoint_id}/#
# Agents publish to: usp/agent/{device_endpoint_id}/request

# ----------------------------------
# WebSocket Transport Layer (MTP)
# ----------------------------------
# WebSocket server for direct device connections
USP_WEBSOCKET_ENABLED=true
USP_WEBSOCKET_HOST=0.0.0.0
USP_WEBSOCKET_PORT=9000

# WebSocket Security (Production)
# USP_WEBSOCKET_SSL=true
# USP_WEBSOCKET_CERT_PATH=/path/to/cert.pem
# USP_WEBSOCKET_KEY_PATH=/path/to/key.pem

# WebSocket Heartbeat
USP_WEBSOCKET_PING_INTERVAL=30
USP_WEBSOCKET_TIMEOUT=90

# ----------------------------------
# HTTP Transport Layer (MTP)
# ----------------------------------
# HTTP polling endpoint for USP devices: POST /usp
USP_HTTP_ENABLED=true
USP_HTTP_REQUEST_TIMEOUT=3600
USP_HTTP_MAX_PENDING_REQUESTS=1000

# ----------------------------------
# Background Daemons Configuration
# ----------------------------------
# These services should run as background processes:
# - php artisan usp:mqtt-subscribe      (MQTT listener)
# - php artisan usp:websocket-server    (WebSocket server)
# - php artisan horizon                 (Queue worker)

# Daemon restart policy
DAEMON_AUTO_RESTART=true
DAEMON_MAX_RESTARTS=5

# ----------------------------------
# Performance & Scalability
# ----------------------------------
# Queue workers (Laravel Horizon)
HORIZON_WORKERS=5
HORIZON_MAX_PROCESSES=10
HORIZON_TIMEOUT=600

# Database connection pool
DB_POOL_MIN=2
DB_POOL_MAX=20

# Rate Limiting (requests per minute)
RATE_LIMIT_API=60
RATE_LIMIT_TR069=300
RATE_LIMIT_LOGIN=5
RATE_LIMIT_MOBILE=120
RATE_LIMIT_WEBSOCKET=60
RATE_LIMIT_BULK=10

# Rate Limit Security (auto-ban)
RATE_LIMIT_MAX_VIOLATIONS=3
RATE_LIMIT_BAN_DURATION=60

# ----------------------------------
# Monitoring & Metrics
# ----------------------------------
# Prometheus metrics endpoint
METRICS_ENABLED=true
METRICS_NAMESPACE=acs
METRICS_ENDPOINT=/metrics
METRICS_AUTH_ENABLED=false
METRICS_AUTH_TOKEN=

# Sentry Error Tracking
SENTRY_ENABLED=false
SENTRY_LARAVEL_DSN=
SENTRY_TRACES_SAMPLE_RATE=0.1
SENTRY_PROFILES_SAMPLE_RATE=0.1
SENTRY_ENVIRONMENT=production
SENTRY_SEND_DEFAULT_PII=false

# Health Check Configuration
HEALTH_CHECK_DATABASE=true
HEALTH_CHECK_REDIS=true
HEALTH_CHECK_QUEUE=true
HEALTH_CHECK_STORAGE=true
HEALTH_CHECK_CACHE_TTL=30

# Alert Thresholds
ALERT_DEVICE_OFFLINE_THRESHOLD=10
ALERT_QUEUE_BACKLOG_THRESHOLD=1000
ALERT_ERROR_RATE_THRESHOLD=5
ALERT_RESPONSE_TIME_THRESHOLD=2000

# ----------------------------------
# Development Tools
# ----------------------------------
VITE_APP_NAME="${APP_NAME}"

# Telescope (Laravel debugging - disable in production)
TELESCOPE_ENABLED=false

# Horizon Dashboard (disable in production or use auth)
HORIZON_DOMAIN=localhost
HORIZON_PATH=horizon

# ----------------------------------
# Security Headers
# ----------------------------------
# CORS allowed origins (comma-separated)
CORS_ALLOWED_ORIGINS=*
# CORS_ALLOWED_ORIGINS=https://admin.example.com,https://dashboard.example.com

# Trusted proxies (for load balancer)
TRUSTED_PROXIES=
# TRUSTED_PROXIES=10.0.0.0/8,172.16.0.0/12,192.168.0.0/16

# ----------------------------------
# Multi-Tenant Configuration
# ----------------------------------
TENANT_ENABLED=true
TENANT_ENFORCE_ISOLATION=true
TENANT_REQUIRE_TENANT=true
TENANT_DEFAULT_ID=1
TENANT_HEADER_NAME=X-Tenant-ID

# Tenant Discovery Methods
TENANT_DISCOVERY_SUBDOMAIN=true
TENANT_DISCOVERY_HEADER=true
TENANT_DISCOVERY_TOKEN=true
TENANT_DISCOVERY_USER=true

# Tenant Cache
TENANT_CACHE_ENABLED=true
TENANT_CACHE_TTL=300

# Tenant Security
TENANT_LOG_CROSS_TENANT=true
TENANT_SECRET_ROTATION_DAYS=90
TENANT_ANOMALY_DETECTION=true
